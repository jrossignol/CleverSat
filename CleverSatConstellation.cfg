CONTRACT_TYPE
{
	name = CleverSatConstellation
	title = Work on a Satellite Constellation
	group = CleverSat
	description = Poor @/targetSat is looking lonely. We'd like you to move it into sync with @/groupSat - maybe they will be friends?
	targetBody = @/targetBody1
	synopsis = Move @/targetSat into the specified orbit
	completedMessage = Well, that should hold them for a while. Until they ask us to move the thing again of course.
	targetBody = @/targetBody1
	rewardFunds = Random(40000,60000)
	rewardReputation = Random(2.0, 5.0)
	
	DATA
	{
	type = List<VesselIdentifier>
	validGroup = $SatList.Add(Group Sat).Where(g => Vessel(g).IsOrbiting())
	}
	
    DATA
    {
        type = int
        groupIndex = Random(0, @validGroup.Count() - 1)
    }
	
	DATA
	{
	type = Vessel
	groupSat = @validGroup.ElementAt(@groupIndex)
	}
	
	//define the maximum deviation we'd be willing to accept when forming a constellation.
	DATA
	{
	type = double
	targetApMin = @groupSat.OrbitApoapsis() - 100000
	targetApMax = @groupSat.OrbitApoapsis() + 100000
	targetPeMin = @groupSat.OrbitPeriapsis() - 100000
	targetPeMax = @groupSat.OrbitPeriapsis() + 100000
	targetInMin = @groupSat.OrbitInclination() - 30
	targetInMax = @groupSat.OrbitInclination() + 30
	}
	
	//find a vessel that is within the parameters specified above.
	DATA
	{
	type = List<VesselIdentifier>
	validTarget = $SatList.Add(Target).Where(t => Vessel(t).IsOrbiting() && Vessel(t).OrbitApoapsis() > @/targetApMin && Vessel(t).OrbitApoapsis() < @/targetApMax && Vessel(t).OrbitPeriapsis() > @/targetPeMin && Vessel(t).OrbitPeriapsis() < @/targetPeMax && Vessel(t).OrbitInclination() > @/targetInMin && Vessel(t).OrbitInclination() < @/targetInMax && Vessel(t).CelestialBody() == @/targetBody1)
	}
	
	    DATA
    {
        type = int
        targetIndex = Random(0, @validTarget.Count() - 1)
    }
	
	DATA
	{
	type = Vessel
	targetSat = @validGroup.ElementAt(@targetIndex)
	}
	
	DATA
	{
	type = CelestialBody
	targetBody1 = @/groupSat.CelestialBody()
	}
	
		DATA
	{
	type = List<VesselIdentifier>
	validConstellation = $SatList.Add(Valid).Where(v => Vessel(v) == @targetSat)
	}
	
	BEHAVIOUR
{
    name = OrbitGenerator
    type = OrbitGenerator

	FIXED_ORBIT
	{
	ORBIT = @/groupSat.Orbit()
	}
}

PARAMETER
{
    name = VesselParameterGroup
    type = VesselParameterGroup
	vessel = @/targetSat
	defineList = ConstellationList
PARAMETER
{
    name = Orbit
	type = ReachSpecificOrbit
	index = 0
	deviationWindow = Prestige() == Trivial ? 10.0 : Prestige() == Significant ? 7.0 : 5.0
}
}
REQUIREMENT
{
name = GroupCheck
type = Expression
expression = @/validConstellation.Count() == 0
}
}
